<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rRACES">
<title>Tissue sampling • rRACES</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tissue sampling">
<meta property="og:description" content="rRACES">
<meta property="og:image" content="https://caravagnalab.github.io/rRACES/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rRACES</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/rRACES.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/tissue_simulation.html">Tissue simulation</a>
    <a class="dropdown-item" href="../articles/sampling.html">Tissue sampling</a>
    <a class="dropdown-item" href="../articles/growth_models.html">Growth Models</a>
    <a class="dropdown-item" href="../articles/mutations.html">Simulating Mutations</a>
    <a class="dropdown-item" href="../articles/sequencing.html">Sequencing Simulation</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/caravagnalab/rRACES/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Tissue sampling</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/caravagnalab/rRACESvignettes/sampling.Rmd" class="external-link"><code>vignettes/sampling.Rmd</code></a></small>
      <div class="d-none name"><code>sampling.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">rRACES</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>Once one has familiarised on how a tumour evolution simulation can be
programmed using rRACES (see `vignette(“tissue_simulation”)), the next
step is to augment the simulation with sampling of tumour cells. This
mimics a realistic experimental design where we gather tumour sequencing
data.</p>
<p>This vignette introduces sampling using different type of models;
starting from simpler up to more complex simulation scenarios we
consider:</p>
<ul>
<li><p><em>multi-region sampling</em>: where at every time point
multiple spatially-separated samples are collected;</p></li>
<li><p><em>longitudinal sampling</em>: where the sampling is repeated at
multiple time-points.</p></li>
</ul>
<div class="section level2">
<h2 id="custom-multi-region-sampling">Custom multi-region sampling<a class="anchor" aria-label="anchor" href="#custom-multi-region-sampling"></a>
</h2>
<p>We consider a simple monoclonal model, without epimutants.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Monoclonal model, no epimutants</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">new</span>(Simulation, <span class="st">"Monoclonal"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">add_mutant</span>(<span class="at">name =</span> <span class="st">"A"</span>, <span class="at">growth_rates =</span> <span class="fl">0.1</span>, <span class="at">death_rates =</span> <span class="fl">0.01</span>)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">place_cell</span>(<span class="st">"A"</span>, <span class="dv">500</span>, <span class="dv">500</span>)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">run_up_to_size</span>(<span class="st">"A"</span>, <span class="dv">60000</span>)</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a> [████████████████████████████████████████] <span class="dv">100</span>% [<span class="dv">00</span>m<span class="sc">:</span><span class="dv">00</span>s] Saving snapshot</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">current</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_tissue.html">plot_tissue</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span><span class="va">current</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-3-1.png" width="288"></p>
<p>A sample is defined by a name and a bounding box, which has a <span class="math inline">\((x,y)\)</span> coordinate for the bottom left
point, and for the top right point.</p>
<p>For this simulation, we define two samples with names
<code>"S_1_2"</code> and <code>"S_1_2"</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We collect a squared box of (bbox_width x bbox_width) cells</span></span>
<span><span class="va">bbox_width</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span></span>
<span><span class="co"># Box A1</span></span>
<span><span class="va">bbox1_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">400</span>, <span class="fl">400</span><span class="op">)</span></span>
<span><span class="va">bbox1_q</span> <span class="op">&lt;-</span> <span class="va">bbox1_p</span> <span class="op">+</span> <span class="va">bbox_width</span></span>
<span></span>
<span><span class="co"># Box B1</span></span>
<span><span class="va">bbox2_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">bbox2_q</span> <span class="op">&lt;-</span> <span class="va">bbox2_p</span> <span class="op">+</span> <span class="va">bbox_width</span></span>
<span></span>
<span><span class="co"># View the boxes</span></span>
<span><span class="va">current</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">bbox1_p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, xmax <span class="op">=</span> <span class="va">bbox1_q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>            ymin <span class="op">=</span> <span class="va">bbox1_p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">bbox1_q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>            fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">bbox2_p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, xmax <span class="op">=</span> <span class="va">bbox2_q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>            ymin <span class="op">=</span> <span class="va">bbox2_p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">bbox2_q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>            fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-4-1.png" width="288"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Sampling</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_1_1"</span>, bottom_left <span class="op">=</span> <span class="va">bbox1_p</span>, top_right <span class="op">=</span> <span class="va">bbox1_q</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_1_2"</span>, bottom_left <span class="op">=</span> <span class="va">bbox2_p</span>, top_right <span class="op">=</span> <span class="va">bbox2_q</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p><em>Note:</em> Sampling removes cells from the tissue, as if the
tissue was surgically resected. Therefore, cells that are mapped to the
bounding box after application of <code>Simulation$sample_cells()</code>
are no longer part of the simulation.</p>
</blockquote>
<p>A new call to <code><a href="../reference/plot_tissue.html">plot_tissue()</a></code> will show the box where the
cells have been removed to be white.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_tissue.html">plot_tissue</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-5-1.png" width="288"></p>
<p>This is also reflected by <code>Simulation$get_cells()</code>, which
now will not find any tumour cell in the sampled region.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This should be empty</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">get_cells</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">400</span>, <span class="fl">400</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">400</span> <span class="op">+</span> <span class="va">bbox_width</span>, <span class="fl">400</span> <span class="op">+</span> <span class="va">bbox_width</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co">#&gt; [1] cell_id    mutant     epistate   position_x position_y</span></span>
<span><span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span></span></code></pre></div>
<p>It should also be remarked that the sampling process exclusively
collects tumor cells, while it excludes wild-type cells.</p>
<div class="section level3">
<h3 id="cell-division-tree-for-sampled-cells">Cell division tree for sampled cells<a class="anchor" aria-label="anchor" href="#cell-division-tree-for-sampled-cells"></a>
</h3>
<p>Every sampled cell is linked, at the evolutionary level, to the other
cells that originate from the same initial cell. It helps to visualise
the evolutionary information on the cells that we have sampled as a
forest of trees (if one seeded multiple initial cells). The forest is an
object of the S4 class <code>SamplesForest</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forest</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">get_samples_forest</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">forest</span></span>
<span><span class="co">#&gt; SamplesForest</span></span>
<span><span class="co">#&gt;   # of trees: 1</span></span>
<span><span class="co">#&gt;   # of nodes: 14251</span></span>
<span><span class="co">#&gt;   # of leaves: 5192</span></span>
<span><span class="co">#&gt;   samples: {"S_1_1", "S_1_2"}</span></span></code></pre></div>
<p>The forest has methods to obtain the nodes of the sampled cells.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forest</span><span class="op">$</span><span class="fu">get_nodes</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co">#&gt;   cell_id ancestor mutant epistate sample birth_time</span></span>
<span><span class="co">#&gt; 1       0       NA      A            &lt;NA&gt;    0.00000</span></span>
<span><span class="co">#&gt; 2       1        0      A            &lt;NA&gt;   18.33874</span></span>
<span><span class="co">#&gt; 3       2        0      A            &lt;NA&gt;   18.33874</span></span>
<span><span class="co">#&gt; 4       3        1      A            &lt;NA&gt;   20.91379</span></span>
<span><span class="co">#&gt; 5       4        1      A            &lt;NA&gt;   20.91379</span></span>
<span><span class="co">#&gt; 6       5        2      A            &lt;NA&gt;   23.77724</span></span></code></pre></div>
<p>The leaves of the forest are sampled cells, while the internal nodes
are their ancestors. The field <code>sample</code> is not available for
internal nodes, and reports the sample name otherwise.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The leaves in the forest represent sampled cells</span></span>
<span><span class="va">forest</span><span class="op">$</span><span class="fu">get_nodes</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">sample</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">head</span></span>
<span><span class="co">#&gt;   cell_id ancestor mutant epistate sample birth_time</span></span>
<span><span class="co">#&gt; 1   73228    40296      A           S_1_2   124.0419</span></span>
<span><span class="co">#&gt; 2   73262    40334      A           S_1_1   124.0473</span></span>
<span><span class="co">#&gt; 3   73263    40304      A           S_1_2   124.0477</span></span>
<span><span class="co">#&gt; 4   73273    40319      A           S_1_2   124.0488</span></span>
<span><span class="co">#&gt; 5   73274    40319      A           S_1_2   124.0488</span></span>
<span><span class="co">#&gt; 6   73281    40328      A           S_1_2   124.0504</span></span></code></pre></div>
<p>The roots of the forest having no ancestors.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If it is one cell, than the forest is a tree</span></span>
<span><span class="va">forest</span><span class="op">$</span><span class="fu">get_nodes</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">ancestor</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   cell_id ancestor mutant epistate sample birth_time</span></span>
<span><span class="co">#&gt; 1       0       NA      A            &lt;NA&gt;          0</span></span></code></pre></div>
<p>We can also query the forest about the samples used to build it.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forest</span><span class="op">$</span><span class="fu">get_samples_info</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;    name xmin ymin xmax ymax tumoural_cells     time</span></span>
<span><span class="co">#&gt; 1 S_1_1  400  400  450  450           2592 130.6534</span></span>
<span><span class="co">#&gt; 2 S_1_2  500  500  550  550           2600 130.6534</span></span></code></pre></div>
<p>We can visualise the forest. This plot reports the cells and, on the
y-axis, their time of birth.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_forest.html">plot_forest</a></span><span class="op">(</span><span class="va">forest</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 1 rows containing non-finite values</span></span>
<span><span class="co">#&gt; (`stat_edge_link()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 1 rows containing missing values (`geom_point()`).</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-12-1.png" width="1056"></p>
<p>The plot shows also samples annotations and species but, for a large
number of cells, it might be complicated to view the full tree, unless a
very large canvas is used. For this reaason, it is possible to subset
the tree.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract the subforest linked to sample</span></span>
<span><span class="va">S_1_1_forest</span> <span class="op">&lt;-</span> <span class="va">forest</span><span class="op">$</span><span class="fu">get_subforest_for</span><span class="op">(</span><span class="st">"S_1_1"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_forest.html">plot_forest</a></span><span class="op">(</span><span class="va">S_1_1_forest</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 1 rows containing non-finite values</span></span>
<span><span class="co">#&gt; (`stat_edge_link()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 1 rows containing missing values (`geom_point()`).</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-13-1.png" width="1056"></p>
<p>In general, these plots can be annotated with extra information, such
as the sampling times, and the MRCAs of each sample in the tree.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Full plot</span></span>
<span><span class="fu"><a href="../reference/plot_forest.html">plot_forest</a></span><span class="op">(</span><span class="va">forest</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/annotate_forest.html">annotate_forest</a></span><span class="op">(</span><span class="va">forest</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> The input forest is not a PhylogeneticForest: cannot annotate signature exposures!</span></span>
<span><span class="co">#&gt; Warning: Removed 1 rows containing non-finite values</span></span>
<span><span class="co">#&gt; (`stat_edge_link()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 1 rows containing missing values (`geom_point()`).</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-14-1.png" width="1056"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># S_1_1 plot</span></span>
<span><span class="fu"><a href="../reference/plot_forest.html">plot_forest</a></span><span class="op">(</span><span class="va">S_1_1_forest</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/annotate_forest.html">annotate_forest</a></span><span class="op">(</span><span class="va">S_1_1_forest</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> The input forest is not a PhylogeneticForest: cannot annotate signature exposures!</span></span>
<span><span class="co">#&gt; Warning: Removed 1 rows containing non-finite values (`stat_edge_link()`).</span></span>
<span><span class="co">#&gt; Removed 1 rows containing missing values (`geom_point()`).</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-14-2.png" width="1056"></p>
</div>
</div>
<div class="section level2">
<h2 id="randomised-multi-region-samples">Randomised multi-region samples<a class="anchor" aria-label="anchor" href="#randomised-multi-region-samples"></a>
</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">new</span>(Simulation, <span class="st">"Randomised"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">add_mutant</span>(<span class="at">name =</span> <span class="st">"A"</span>, <span class="at">growth_rates =</span> <span class="fl">0.1</span>, <span class="at">death_rates =</span> <span class="fl">0.01</span>)</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">place_cell</span>(<span class="st">"A"</span>, <span class="dv">500</span>, <span class="dv">500</span>)</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">run_up_to_size</span>(<span class="st">"A"</span>, <span class="dv">60000</span>)</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a> [████████████████████████████████████████] <span class="dv">100</span>% [<span class="dv">00</span>m<span class="sc">:</span><span class="dv">00</span>s] Saving snapshot</span></code></pre></div>
<p>We include a new mutant and let it grow. This new mutant has much
higher growth rates than its ancestor.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># Add a new mutant</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">add_mutant</span>(<span class="at">name =</span> <span class="st">"B"</span>, <span class="at">growth_rates =</span> <span class="dv">1</span>, <span class="at">death_rates =</span> <span class="fl">0.01</span>)</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">mutate_progeny</span>(sim<span class="sc">$</span><span class="fu">choose_cell_in</span>(<span class="st">"A"</span>), <span class="st">"B"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">run_up_to_size</span>(<span class="st">"B"</span>, <span class="dv">10000</span>)</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a> [██████████████████████████████████████<span class="sc">--</span>] <span class="dv">94</span>% [<span class="dv">00</span>m<span class="sc">:</span><span class="dv">00</span>s] Cells<span class="sc">:</span> <span class="dv">172145</span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a> [████████████████████████████████████████] <span class="dv">100</span>% [<span class="dv">00</span>m<span class="sc">:</span><span class="dv">00</span>s] Saving snapshot</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>current <span class="ot">&lt;-</span> <span class="fu">plot_tissue</span>(sim)</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>current</span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-16-1.png" width="288"></p>
<p>Since mutant start has been randomised by
<code>Simulation$choose_cell_in()</code>, we have no exact idea of where
to sample to obtain for example, <span class="math inline">\(100\)</span> of its cells. We can look visually at
the simulation, but this is slow.</p>
<p>rRACES provides a <code>Simulation$search_sample()</code> function to
sample bounding boxes that contain a desired number of cells. The
function takes in input:</p>
<ul>
<li>a bounding box size;</li>
<li>the number <span class="math inline">\(n\)</span> of cells to sample
for a species of interest.</li>
</ul>
<p><code>Simulation$search_sample()</code> will attempt a fixed number
of times to sample the box, starting from positions occupied by the
species of interest. If a box that contains at least <span class="math inline">\(n\)</span> cells is not found within a number of
attempts, then the one with the largest number of samples is
returned.</p>
<p>This allows to program sampling without having a clear idea of the
tissue conformation.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A bounding box 50x50 with at least 100 cells of species B</span></span>
<span><span class="va">n_w</span> <span class="op">&lt;-</span> <span class="va">n_h</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">ncells</span> <span class="op">&lt;-</span> <span class="fl">0.8</span><span class="op">*</span><span class="va">n_w</span><span class="op">*</span><span class="va">n_h</span></span>
<span></span>
<span><span class="co"># Sampling ncells with random box sampling of boxes of size n_w x n_h</span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">search_sample</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span> <span class="op">=</span> <span class="va">ncells</span><span class="op">)</span>, <span class="va">n_w</span>, <span class="va">n_h</span><span class="op">)</span></span>
<span></span>
<span><span class="va">current</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, xmax <span class="op">=</span> <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>            ymin <span class="op">=</span> <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>            fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-17-1.png" width="288"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_2_1"</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">)</span></span></code></pre></div>
<p>Something similar with species <code>A</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">search_sample</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="va">ncells</span><span class="op">)</span>, <span class="va">n_w</span>, <span class="va">n_h</span><span class="op">)</span></span>
<span></span>
<span><span class="va">current</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, xmax <span class="op">=</span> <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>            ymin <span class="op">=</span> <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>            fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-19-1.png" width="288"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_2_2"</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">)</span></span></code></pre></div>
<p>The two samples have been extracted.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_tissue.html">plot_tissue</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-21-1.png" width="288"></p>
<p>Cell division tree.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forest</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">get_samples_forest</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_forest.html">plot_forest</a></span><span class="op">(</span><span class="va">forest</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/annotate_forest.html">annotate_forest</a></span><span class="op">(</span><span class="va">forest</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> The input forest is not a PhylogeneticForest: cannot annotate signature exposures!</span></span>
<span><span class="co">#&gt; Warning: Removed 1 rows containing non-finite values</span></span>
<span><span class="co">#&gt; (`stat_edge_link()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 1 rows containing missing values (`geom_point()`).</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-22-1.png" width="1056"></p>
</div>
<div class="section level2">
<h2 id="two-populations-with-epigenetic-state">Two populations with epigenetic state<a class="anchor" aria-label="anchor" href="#two-populations-with-epigenetic-state"></a>
</h2>
<p>We are now ready to simulate a model with epigenetic switches and
subclonal expansions.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">new</span>(Simulation, <span class="st">"Two Populations"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>sim<span class="sc">$</span>death_activation_level <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="co"># First mutant</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">add_mutant</span>(<span class="at">name =</span> <span class="st">"A"</span>,</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>               <span class="at">epigenetic_rates =</span> <span class="fu">c</span>(<span class="st">"+-"</span> <span class="ot">=</span> <span class="fl">0.01</span>, <span class="st">"-+"</span> <span class="ot">=</span> <span class="fl">0.01</span>),</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>               <span class="at">growth_rates =</span> <span class="fu">c</span>(<span class="st">"+"</span> <span class="ot">=</span> <span class="fl">0.1</span>, <span class="st">"-"</span> <span class="ot">=</span> <span class="fl">0.08</span>),</span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>               <span class="at">death_rates =</span> <span class="fu">c</span>(<span class="st">"+"</span> <span class="ot">=</span> <span class="fl">0.1</span>, <span class="st">"-"</span> <span class="ot">=</span> <span class="fl">0.01</span>))</span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">place_cell</span>(<span class="st">"A+"</span>, <span class="dv">500</span>, <span class="dv">500</span>)</span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">run_up_to_size</span>(<span class="st">"A+"</span>, <span class="dv">1000</span>)</span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a> [████████████████████████████████████████] <span class="dv">100</span>% [<span class="dv">00</span>m<span class="sc">:</span><span class="dv">00</span>s] Saving snapshot</span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a><span class="fu">plot_tissue</span>(sim, <span class="at">num_of_bins =</span> <span class="dv">500</span>)</span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-23-1.png" width="288"></p>
<p>We sample before introducing a new mutant.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bbox_width</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_1_1"</span>,</span>
<span>                 bottom_left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">480</span>, <span class="fl">480</span><span class="op">)</span>,</span>
<span>                 top_right <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">480</span> <span class="op">+</span> <span class="va">bbox_width</span>, <span class="fl">480</span> <span class="op">+</span> <span class="va">bbox_width</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_1_2"</span>,</span>
<span>                 bottom_left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>                 top_right <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span> <span class="op">+</span> <span class="va">bbox_width</span>, <span class="fl">500</span> <span class="op">+</span> <span class="va">bbox_width</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_tissue.html">plot_tissue</a></span><span class="op">(</span><span class="va">sim</span>, num_of_bins <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-24-1.png" width="288"></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="co"># Let it grow a bit more</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">run_up_to_time</span>(sim<span class="sc">$</span><span class="fu">get_clock</span>() <span class="sc">+</span> <span class="dv">15</span>)</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a> [████████████████████████████████████████] <span class="dv">100</span>% [<span class="dv">00</span>m<span class="sc">:</span><span class="dv">00</span>s] Saving snapshot</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a><span class="fu">plot_tissue</span>(sim, <span class="at">num_of_bins =</span> <span class="dv">500</span>)</span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-25-1.png" width="288"></p>
<p>Add a new submutant.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>cell <span class="ot">&lt;-</span> sim<span class="sc">$</span><span class="fu">choose_cell_in</span>(<span class="st">"A"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">add_mutant</span>(<span class="at">name =</span> <span class="st">"B"</span>,</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>               <span class="at">epigenetic_rates =</span> <span class="fu">c</span>(<span class="st">"+-"</span> <span class="ot">=</span> <span class="fl">0.05</span>, <span class="st">"-+"</span> <span class="ot">=</span> <span class="fl">0.1</span>),</span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>               <span class="at">growth_rates =</span> <span class="fu">c</span>(<span class="st">"+"</span> <span class="ot">=</span> <span class="fl">0.5</span>, <span class="st">"-"</span> <span class="ot">=</span> <span class="fl">0.3</span>),</span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>               <span class="at">death_rates =</span> <span class="fu">c</span>(<span class="st">"+"</span> <span class="ot">=</span> <span class="fl">0.05</span>, <span class="st">"-"</span> <span class="ot">=</span> <span class="fl">0.05</span>))</span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">mutate_progeny</span>(cell, <span class="st">"B"</span>)</span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a><span class="co"># let it grow more time units</span></span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">run_up_to_time</span>(sim<span class="sc">$</span><span class="fu">get_clock</span>() <span class="sc">+</span> <span class="dv">25</span>)</span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a> [███████████████████████████████████████<span class="sc">-</span>] <span class="dv">97</span>% [<span class="dv">00</span>m<span class="sc">:</span><span class="dv">00</span>s] Cells<span class="sc">:</span> <span class="dv">125544</span></span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a> [████████████████████████████████████████] <span class="dv">98</span>% [<span class="dv">00</span>m<span class="sc">:</span><span class="dv">01</span>s] Cells<span class="sc">:</span> <span class="dv">199987</span></span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a> [████████████████████████████████████████] <span class="dv">99</span>% [<span class="dv">00</span>m<span class="sc">:</span><span class="dv">02</span>s] Cells<span class="sc">:</span> <span class="dv">256468</span></span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a> [████████████████████████████████████████] <span class="dv">99</span>% [<span class="dv">00</span>m<span class="sc">:</span><span class="dv">03</span>s] Cells<span class="sc">:</span> <span class="dv">302982</span></span>
<span id="cb28-17"><a href="#cb28-17" tabindex="-1"></a> [████████████████████████████████████████] <span class="dv">99</span>% [<span class="dv">00</span>m<span class="sc">:</span><span class="dv">04</span>s] Cells<span class="sc">:</span> <span class="dv">343981</span></span>
<span id="cb28-18"><a href="#cb28-18" tabindex="-1"></a> [████████████████████████████████████████] <span class="dv">99</span>% [<span class="dv">00</span>m<span class="sc">:</span><span class="dv">05</span>s] Cells<span class="sc">:</span> <span class="dv">380335</span></span>
<span id="cb28-19"><a href="#cb28-19" tabindex="-1"></a> [████████████████████████████████████████] <span class="dv">99</span>% [<span class="dv">00</span>m<span class="sc">:</span><span class="dv">06</span>s] Cells<span class="sc">:</span> <span class="dv">409404</span></span>
<span id="cb28-20"><a href="#cb28-20" tabindex="-1"></a> [████████████████████████████████████████] <span class="dv">99</span>% [<span class="dv">00</span>m<span class="sc">:</span><span class="dv">07</span>s] Cells<span class="sc">:</span> <span class="dv">433466</span></span>
<span id="cb28-21"><a href="#cb28-21" tabindex="-1"></a> [████████████████████████████████████████] <span class="dv">100</span>% [<span class="dv">00</span>m<span class="sc">:</span><span class="dv">07</span>s] Saving snapshot</span>
<span id="cb28-22"><a href="#cb28-22" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" tabindex="-1"></a><span class="fu">plot_tissue</span>(sim, <span class="at">num_of_bins =</span> <span class="dv">500</span>)</span>
<span id="cb28-24"><a href="#cb28-24" tabindex="-1"></a><span class="co">#&gt; Warning:  [1m [22mRemoved 26 rows containing missing values (`geom_hex()`).</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-26-1.png" width="288"></p>
<p>Sample again and plot the tissue</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_w</span> <span class="op">&lt;-</span> <span class="va">n_h</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">ncells</span> <span class="op">&lt;-</span> <span class="fl">0.8</span><span class="op">*</span><span class="va">n_w</span><span class="op">*</span><span class="va">n_h</span></span>
<span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">search_sample</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="va">ncells</span><span class="op">)</span>, <span class="va">n_w</span>, <span class="va">n_h</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_2_1"</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">search_sample</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span> <span class="op">=</span> <span class="va">ncells</span><span class="op">)</span>, <span class="va">n_w</span>, <span class="va">n_h</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_2_2"</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_tissue.html">plot_tissue</a></span><span class="op">(</span><span class="va">sim</span>, num_of_bins <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 26 rows containing missing values (`geom_hex()`).</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-27-1.png" width="288"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_muller.html">plot_muller</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `filter_()` was deprecated in dplyr 0.7.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `filter()` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See vignette('programming') for more help</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">ggmuller</span> package.</span></span>
<span><span class="co">#&gt;   Please report the issue to the authors.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; Warning: `summarise_()` was deprecated in dplyr 0.7.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `summarise()` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">ggmuller</span> package.</span></span>
<span><span class="co">#&gt;   Please report the issue to the authors.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; Warning: `group_by_()` was deprecated in dplyr 0.7.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `group_by()` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See vignette('programming') for more help</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">ggmuller</span> package.</span></span>
<span><span class="co">#&gt;   Please report the issue to the authors.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; Warning: `arrange_()` was deprecated in dplyr 0.7.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `arrange()` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See vignette('programming') for more help</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">ggmuller</span> package.</span></span>
<span><span class="co">#&gt;   Please report the issue to the authors.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; Warning: `select_()` was deprecated in dplyr 0.7.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `select()` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">ggmuller</span> package.</span></span>
<span><span class="co">#&gt;   Please report the issue to the authors.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; Warning: The `&lt;scale&gt;` argument of `guides()` cannot be `FALSE`. Use "none" instead as</span></span>
<span><span class="co">#&gt; of ggplot2 3.3.4.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">ggmuller</span> package.</span></span>
<span><span class="co">#&gt;   Please report the issue to the authors.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">fill</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">fill</span>, which will replace the existing scale.</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-27-2.png" width="288"></p>
<p>Now we show the cell division tree, which starts being rather
complicated</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forest</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">get_samples_forest</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_forest.html">plot_forest</a></span><span class="op">(</span><span class="va">forest</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/annotate_forest.html">annotate_forest</a></span><span class="op">(</span><span class="va">forest</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> The input forest is not a PhylogeneticForest: cannot annotate signature exposures!</span></span>
<span><span class="co">#&gt; Warning: Removed 1 rows containing non-finite values</span></span>
<span><span class="co">#&gt; (`stat_edge_link()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 1 rows containing missing values (`geom_point()`).</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-28-1.png" width="1632"></p>
</div>
<div class="section level2">
<h2 id="more-complex-example">More complex example<a class="anchor" aria-label="anchor" href="#more-complex-example"></a>
</h2>
<p>Some features allow for a smarter sampling and more advanced
visualisation.</p>
<p>We build a tumour with three populations, branching.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">new</span>(Simulation, <span class="st">"Three Populations"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>sim<span class="sc">$</span>death_activation_level <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">update_tissue</span>(<span class="dv">250</span>, <span class="dv">250</span>)</span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">add_mutant</span>(<span class="at">name =</span> <span class="st">"A"</span>, <span class="at">growth_rates =</span> <span class="fl">0.08</span>, <span class="at">death_rates =</span> <span class="fl">0.01</span>)</span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">place_cell</span>(<span class="st">"A"</span>, <span class="dv">125</span>, <span class="dv">125</span>)</span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">run_up_to_size</span>(<span class="st">"A"</span>, <span class="dv">300</span>)</span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a> [████████████████████████████████████████] <span class="dv">100</span>% [<span class="dv">00</span>m<span class="sc">:</span><span class="dv">00</span>s] Saving snapshot</span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a><span class="fu">plot_tissue</span>(sim)</span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-29-1.png" width="288"></p>
<p>We sample</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_w</span> <span class="op">&lt;-</span> <span class="va">n_h</span> <span class="op">&lt;-</span> <span class="fl">7</span></span>
<span><span class="va">ncells</span> <span class="op">&lt;-</span> <span class="fl">0.3</span><span class="op">*</span><span class="va">n_w</span><span class="op">*</span><span class="va">n_h</span></span>
<span></span>
<span><span class="co"># Sampling ncells with random box sampling of boxes of size n_w x n_h</span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">search_sample</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="va">ncells</span><span class="op">)</span>, <span class="va">n_w</span>, <span class="va">n_h</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_1_1"</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">search_sample</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="va">ncells</span><span class="op">)</span>, <span class="va">n_w</span>, <span class="va">n_h</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_1_2"</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_tissue.html">plot_tissue</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-30-1.png" width="288"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_muller.html">plot_muller</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span></code></pre></div>
<p>Second mutant starts.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="co"># New submutant</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">add_mutant</span>(<span class="at">name =</span> <span class="st">"B"</span>, <span class="at">growth_rates =</span> <span class="fl">0.13</span>, <span class="at">death_rates =</span> <span class="fl">0.01</span>)</span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">mutate_progeny</span>(sim<span class="sc">$</span><span class="fu">choose_cell_in</span>(<span class="st">"A"</span>), <span class="st">"B"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">run_up_to_size</span>(<span class="st">"B"</span>, <span class="dv">400</span>)</span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a> [████████████████████████████████████████] <span class="dv">100</span>% [<span class="dv">00</span>m<span class="sc">:</span><span class="dv">00</span>s] Saving snapshot</span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a><span class="fu">plot_tissue</span>(sim)</span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-32-1.png" width="288"></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_muller.html">plot_muller</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">fill</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">fill</span>, which will replace the existing scale.</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-32-2.png" width="288"></p>
<p>Random sampling of cells from both mutant <code>A</code> and
<code>B</code>.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sampling with random box sampling</span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">search_sample</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="va">ncells</span><span class="op">)</span>, <span class="va">n_w</span>, <span class="va">n_h</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_2_1"</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">search_sample</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span> <span class="op">=</span> <span class="va">ncells</span><span class="op">)</span>, <span class="va">n_w</span>, <span class="va">n_h</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_2_2"</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_tissue.html">plot_tissue</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-33-1.png" width="288"></p>
<p>Finally, a third mutant branching from <code>A</code>.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="co"># New submutant</span></span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">add_mutant</span>(<span class="at">name =</span> <span class="st">"C"</span>, <span class="at">growth_rates =</span> <span class="fl">0.6</span>, <span class="at">death_rates =</span> <span class="fl">0.01</span>)</span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">mutate_progeny</span>(sim<span class="sc">$</span><span class="fu">choose_cell_in</span>(<span class="st">"A"</span>), <span class="st">"C"</span>)</span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a>sim<span class="sc">$</span><span class="fu">run_up_to_size</span>(<span class="st">"C"</span>, <span class="dv">1000</span>)</span>
<span id="cb38-6"><a href="#cb38-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb38-7"><a href="#cb38-7" tabindex="-1"></a> [████████████████████████████████████████] <span class="dv">100</span>% [<span class="dv">00</span>m<span class="sc">:</span><span class="dv">00</span>s] Saving snapshot</span>
<span id="cb38-8"><a href="#cb38-8" tabindex="-1"></a><span class="fu">plot_tissue</span>(sim)</span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-34-1.png" width="288"></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_muller.html">plot_muller</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">fill</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">fill</span>, which will replace the existing scale.</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-34-2.png" width="288"></p>
<p>With sampling of mutants <code>B</code> and <code>C</code>.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sampling with random box sampling</span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">search_sample</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span> <span class="op">=</span> <span class="va">ncells</span><span class="op">)</span>, <span class="va">n_w</span>, <span class="va">n_h</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_3_1"</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">search_sample</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span> <span class="op">=</span> <span class="va">ncells</span><span class="op">)</span>, <span class="va">n_w</span>, <span class="va">n_h</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_3_2"</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_tissue.html">plot_tissue</a></span><span class="op">(</span><span class="va">sim</span>, num_of_bins <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-35-1.png" width="288"></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_muller.html">plot_muller</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">fill</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">fill</span>, which will replace the existing scale.</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-35-2.png" width="288"></p>
<p>Finally, the tree plot where we annotate samples and MRCAs of each
sample.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Tree data</span></span>
<span><span class="va">forest</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">get_samples_forest</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_forest.html">plot_forest</a></span><span class="op">(</span><span class="va">forest</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/annotate_forest.html">annotate_forest</a></span><span class="op">(</span><span class="va">forest</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> The input forest is not a PhylogeneticForest: cannot annotate signature exposures!</span></span>
<span><span class="co">#&gt; Warning: Removed 1 rows containing non-finite values</span></span>
<span><span class="co">#&gt; (`stat_edge_link()`).</span></span>
<span><span class="co">#&gt; Warning: The shape palette can deal with a maximum of 6 discrete values because more</span></span>
<span><span class="co">#&gt; than 6 becomes difficult to discriminate</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> you have requested 7 values. Consider specifying shapes manually if you need</span></span>
<span><span class="co">#&gt;   that many have them.</span></span>
<span><span class="co">#&gt; Warning: Removed 43 rows containing missing values (`geom_point()`).</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-36-1.png" width="1632"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Giulio Caravagna, Alberto Casagrande.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
