<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Tissue sampling • ProCESS</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tissue sampling">
<meta name="description" content="How to sample cells from a simulated tissue
">
<meta property="og:description" content="How to sample cells from a simulated tissue
">
<meta property="og:image" content="https://caravagnalab.github.io/ProCESS/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ProCESS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/ProCESS.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/tissue_simulation.html">Tissue simulation</a></li>
    <li><a class="dropdown-item" href="../articles/sampling.html">Tissue sampling</a></li>
    <li><a class="dropdown-item" href="../articles/mutations.html">Simulating Mutations</a></li>
    <li><a class="dropdown-item" href="../articles/sequencing.html">Sequencing Simulation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/caravagnalab/ProCESS/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Tissue sampling</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/caravagnalab/ProCESS/vignettes/sampling.Rmd" class="external-link"><code>vignettes/sampling.Rmd</code></a></small>
      <div class="d-none name"><code>sampling.Rmd</code></div>
    </div>

    
    
<blockquote>
<p><em>Disclaimer:</em> RACES/ProCESS internally implements the
probability distributions using the C++11 random number distribution
classes whose algorithms are not defined by the standard. Thus, the
simulation depends on the compiler used to compile ProCESS, and because
of that, the results reported in this article may differ from those
obtained by the reader.</p>
</blockquote>
<p>Once one has familiarised on how a tumour evolution simulation can be
programmed using ProCESS (see
<code><a href="../articles/tissue_simulation.html">vignette("tissue_simulation")</a></code>), the next step is to augment
the simulation with sampling of tumour cells. This mimics a realistic
experimental design where we gather tumour sequencing data.</p>
<p>This vignette introduces sampling using different type of models;
starting from simpler up to more complex simulation scenarios we
consider:</p>
<ul>
<li><p><em>multi-region sampling</em>: where at every time point
multiple spatially-separated samples are collected;</p></li>
<li><p><em>longitudinal sampling</em>: where the sampling is repeated at
multiple time-points.</p></li>
</ul>
<div class="section level2">
<h2 id="custom-multi-region-sampling">Custom multi-region sampling<a class="anchor" aria-label="anchor" href="#custom-multi-region-sampling"></a>
</h2>
<p>We consider a simple monoclonal model, without epimutants.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://caravagnalab.github.io/ProCESS">ProCESS</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set the seed of the random number generator</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Monoclonal model, no epimutants</span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SpatialSimulation.html">SpatialSimulation</a></span><span class="op">(</span><span class="st">"Monoclonal"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_mutant</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"A"</span>, growth_rates <span class="op">=</span> <span class="fl">0.1</span>, death_rates <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">place_cell</span><span class="op">(</span><span class="st">"A"</span>, <span class="fl">500</span>, <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">run_up_to_size</span><span class="op">(</span><span class="st">"A"</span>, <span class="fl">60000</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [█████████████████████████---------------] 61% [00m:00s] Cells: 36994 [████████████████████████████████████████] 98% [00m:01s] Cells: 59161 [████████████████████████████████████████] 100% [00m:01s] Saving snapshot</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">current</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_tissue.html">plot_tissue</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span><span class="va">current</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-3-1.png" width="288"></p>
<p>A sample is defined by a name and a bounding box, which has a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(x,y)</annotation></semantics></math>
coordinate for the bottom left point, and for the top right point.</p>
<p>For this simulation, we define two samples with names
<code>"S_1_2"</code> and <code>"S_1_2"</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We collect a squared box of (bbox_width x bbox_width) cells</span></span>
<span><span class="va">bbox_width</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span></span>
<span><span class="co"># Box A1</span></span>
<span><span class="va">bbox1_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">400</span>, <span class="fl">400</span><span class="op">)</span></span>
<span><span class="va">bbox1_q</span> <span class="op">&lt;-</span> <span class="va">bbox1_p</span> <span class="op">+</span> <span class="va">bbox_width</span></span>
<span></span>
<span><span class="co"># Box B1</span></span>
<span><span class="va">bbox2_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">bbox2_q</span> <span class="op">&lt;-</span> <span class="va">bbox2_p</span> <span class="op">+</span> <span class="va">bbox_width</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the boxes</span></span>
<span><span class="va">current</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">bbox1_p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, xmax <span class="op">=</span> <span class="va">bbox1_q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>            ymin <span class="op">=</span> <span class="va">bbox1_p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">bbox1_q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>            fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">bbox2_p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, xmax <span class="op">=</span> <span class="va">bbox2_q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>            ymin <span class="op">=</span> <span class="va">bbox2_p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">bbox2_q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>            fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-4-1.png" width="288"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Sampling</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_1_1"</span>, bottom_left <span class="op">=</span> <span class="va">bbox1_p</span>, top_right <span class="op">=</span> <span class="va">bbox1_q</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_1_2"</span>, bottom_left <span class="op">=</span> <span class="va">bbox2_p</span>, top_right <span class="op">=</span> <span class="va">bbox2_q</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p><em>Note:</em> Sampling removes cells from the tissue, as if the
tissue was surgically resected. Therefore, cells that are mapped to the
bounding box after application of
<code>SpatialSimulation$sample_cells()</code> are no longer part of the
simulation.</p>
</blockquote>
<p>A new call to <code><a href="../reference/plot_tissue.html">plot_tissue()</a></code> will show the box where the
cells have been removed to be white.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_tissue.html">plot_tissue</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-5-1.png" width="288"></p>
<p>This is also reflected by <code>SpatialSimulation$get_cells()</code>,
which now will not find any tumour cell in the sampled region.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span></span>
<span><span class="co"># This should be empty</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">get_cells</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">400</span>, <span class="fl">400</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">400</span> <span class="op">+</span> <span class="va">bbox_width</span>, <span class="fl">400</span> <span class="op">+</span> <span class="va">bbox_width</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co">#&gt; [1] cell_id    mutant     epistate   position_x position_y</span></span>
<span><span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span></span></code></pre></div>
<p>It should also be remarked that the sampling process exclusively
collects tumour cells, while it excludes wild-type cells.</p>
<div class="section level3">
<h3 id="cell-division-tree-for-sampled-cells">Cell division tree for sampled cells<a class="anchor" aria-label="anchor" href="#cell-division-tree-for-sampled-cells"></a>
</h3>
<p>Every sampled cell is linked, at the evolutionary level, to the other
cells that originate from the same initial cell. It helps to visualise
the evolutionary information on the cells that we have sampled as a
forest of trees (if one seeded multiple initial cells). The forest is an
object of the S4 class <code>SamplesForest</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forest</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">get_samples_forest</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">forest</span></span>
<span><span class="co">#&gt; SamplesForest</span></span>
<span><span class="co">#&gt;   # of trees: 1</span></span>
<span><span class="co">#&gt;   # of nodes: 18255</span></span>
<span><span class="co">#&gt;   # of leaves: 5181</span></span>
<span><span class="co">#&gt;   samples: {"S_1_1", "S_1_2"}</span></span></code></pre></div>
<p>The forest has methods to obtain the nodes of the sampled cells.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forest</span><span class="op">$</span><span class="fu">get_nodes</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co">#&gt;   cell_id ancestor mutant epistate sample birth_time</span></span>
<span><span class="co">#&gt; 1       0       NA      A            &lt;NA&gt;   0.000000</span></span>
<span><span class="co">#&gt; 2       1        0      A            &lt;NA&gt;   5.741436</span></span>
<span><span class="co">#&gt; 3       2        0      A            &lt;NA&gt;   5.741436</span></span>
<span><span class="co">#&gt; 4       3        2      A            &lt;NA&gt;   8.545185</span></span>
<span><span class="co">#&gt; 5       4        2      A            &lt;NA&gt;   8.545185</span></span>
<span><span class="co">#&gt; 6       5        1      A            &lt;NA&gt;  11.583620</span></span></code></pre></div>
<p>The leaves of the forest are sampled cells, while the internal nodes
are their ancestors. The field <code>sample</code> is not available for
internal nodes, and reports the sample name otherwise.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The leaves in the forest represent sampled cells</span></span>
<span><span class="va">forest</span><span class="op">$</span><span class="fu">get_nodes</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">sample</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">head</span></span>
<span><span class="co">#&gt;   cell_id ancestor mutant epistate sample birth_time</span></span>
<span><span class="co">#&gt; 1   14350     3768      A           S_1_2   181.9186</span></span>
<span><span class="co">#&gt; 2   18621    14799      A           S_1_2   197.6872</span></span>
<span><span class="co">#&gt; 3   21101     3988      A           S_1_2   205.8270</span></span>
<span><span class="co">#&gt; 4   26307    18963      A           S_1_2   220.3426</span></span>
<span><span class="co">#&gt; 5   27246    22386      A           S_1_2   222.8447</span></span>
<span><span class="co">#&gt; 6   27814    17642      A           S_1_1   224.2599</span></span></code></pre></div>
<p>The roots of the forest having no ancestors.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If it is one cell, than the forest is a tree</span></span>
<span><span class="va">forest</span><span class="op">$</span><span class="fu">get_nodes</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">ancestor</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   cell_id ancestor mutant epistate sample birth_time</span></span>
<span><span class="co">#&gt; 1       0       NA      A            &lt;NA&gt;          0</span></span></code></pre></div>
<p>We can also query the forest about the samples used to build it.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forest</span><span class="op">$</span><span class="fu">get_samples_info</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;    name id xmin ymin xmax ymax tumour_cells tumour_cells_in_bbox     time</span></span>
<span><span class="co">#&gt; 1 S_1_1  0  400  400  450  450         2588                 2588 397.0568</span></span>
<span><span class="co">#&gt; 2 S_1_2  1  500  500  550  550         2593                 2593 397.0568</span></span></code></pre></div>
<p>We can visualise the forest. This plot reports the cells and, on the
y-axis, their time of birth.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_forest.html">plot_forest</a></span><span class="op">(</span><span class="va">forest</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-12-1.png" width="1056"></p>
<p>The plot shows also samples annotations and species but, for a large
number of cells, it might be complicated to view the full tree, unless a
very large canvas is used. For this reaason, it is possible to subset
the tree.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract the subforest linked to sample</span></span>
<span><span class="va">S_1_1_forest</span> <span class="op">&lt;-</span> <span class="va">forest</span><span class="op">$</span><span class="fu">get_subforest_for</span><span class="op">(</span><span class="st">"S_1_1"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_forest.html">plot_forest</a></span><span class="op">(</span><span class="va">S_1_1_forest</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-13-1.png" width="1056"></p>
<p>In general, these plots can be annotated with extra information, such
as the sampling times, and the MRCAs of each sample in the tree.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Full plot</span></span>
<span><span class="fu"><a href="../reference/plot_forest.html">plot_forest</a></span><span class="op">(</span><span class="va">forest</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/annotate_forest.html">annotate_forest</a></span><span class="op">(</span><span class="va">forest</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-14-1.png" width="1056"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># S_1_1 plot</span></span>
<span><span class="fu"><a href="../reference/plot_forest.html">plot_forest</a></span><span class="op">(</span><span class="va">S_1_1_forest</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/annotate_forest.html">annotate_forest</a></span><span class="op">(</span><span class="va">S_1_1_forest</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-14-2.png" width="1056"></p>
</div>
</div>
<div class="section level2">
<h2 id="randomised-multi-region-samples">Randomised multi-region samples<a class="anchor" aria-label="anchor" href="#randomised-multi-region-samples"></a>
</h2>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set the seed of the random number generator</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SpatialSimulation.html">SpatialSimulation</a></span><span class="op">(</span><span class="st">"Randomised"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_mutant</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"A"</span>, growth_rates <span class="op">=</span> <span class="fl">0.1</span>, death_rates <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">place_cell</span><span class="op">(</span><span class="st">"A"</span>, <span class="fl">500</span>, <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">run_up_to_size</span><span class="op">(</span><span class="st">"A"</span>, <span class="fl">60000</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [█████████████████████-------------------] 51% [00m:00s] Cells: 31138 [██████████████████████████████████------] 83% [00m:01s] Cells: 50270 [████████████████████████████████████████] 100% [00m:01s] Saving snapshot</span></span></code></pre></div>
<p>We include a new mutant and let it grow. This new mutant has much
higher growth rates than its ancestor.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add a new mutant</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_mutant</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"B"</span>, growth_rates <span class="op">=</span> <span class="fl">1</span>, death_rates <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">mutate_progeny</span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="fu">choose_cell_in</span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span>, <span class="st">"B"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">run_up_to_size</span><span class="op">(</span><span class="st">"B"</span>, <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [█████████████---------------------------] 32% [00m:00s] Cells: 88019 [████████████████████████████████████████] 100% [00m:00s] Saving snapshot</span></span>
<span></span>
<span><span class="va">current</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_tissue.html">plot_tissue</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span><span class="va">current</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-16-1.png" width="288"></p>
<p>Since mutant start has been randomised by
<code>SpatialSimulation$choose_cell_in()</code>, we have no exact idea
of where to sample to obtain for example,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>100</mn><annotation encoding="application/x-tex">100</annotation></semantics></math>
of its cells. We can look visually at the simulation, but this is
slow.</p>
<p>ProCESS provides a <code>SpatialSimulation$search_sample()</code>
function to sample bounding boxes that contain a desired number of
cells. The function takes in input:</p>
<ul>
<li>a bounding box size;</li>
<li>the number
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
of cells to sample for a species of interest.</li>
</ul>
<p><code>SpatialSimulation$search_sample()</code> will attempt a fixed
number of times to sample the box, starting from positions occupied by
the species of interest. If a box that contains at least
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
cells is not found within a number of attempts, then the one with the
largest number of samples is returned.</p>
<p>This allows to program sampling without having a clear idea of the
tissue conformation.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A bounding box 50x50 with at least 100 cells of species B</span></span>
<span><span class="va">n_w</span> <span class="op">&lt;-</span> <span class="va">n_h</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">ncells</span> <span class="op">&lt;-</span> <span class="fl">0.8</span> <span class="op">*</span> <span class="va">n_w</span> <span class="op">*</span> <span class="va">n_h</span></span>
<span></span>
<span><span class="co"># Sampling ncells with random box sampling of boxes of size n_w x n_h</span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">search_sample</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span> <span class="op">=</span> <span class="va">ncells</span><span class="op">)</span>, <span class="va">n_w</span>, <span class="va">n_h</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the bounding box</span></span>
<span><span class="va">current</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, xmax <span class="op">=</span> <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>            ymin <span class="op">=</span> <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>            fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-17-1.png" width="288"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sample the tissue</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_2_1"</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">)</span></span></code></pre></div>
<p>Something similar with species <code>A</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">search_sample</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="va">ncells</span><span class="op">)</span>, <span class="va">n_w</span>, <span class="va">n_h</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the bounding box</span></span>
<span><span class="va">current</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, xmax <span class="op">=</span> <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>            ymin <span class="op">=</span> <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>            fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-19-1.png" width="288"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sample the tissue</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_2_2"</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">)</span></span></code></pre></div>
<p>The two samples have been extracted.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_tissue.html">plot_tissue</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-21-1.png" width="288"></p>
<p>Cell division tree.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forest</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">get_samples_forest</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_forest.html">plot_forest</a></span><span class="op">(</span><span class="va">forest</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/annotate_forest.html">annotate_forest</a></span><span class="op">(</span><span class="va">forest</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-22-1.png" width="1056"></p>
</div>
<div class="section level2">
<h2 id="randomised-cell-sampling-liquid-biopsy">Randomised cell sampling (Liquid biopsy)<a class="anchor" aria-label="anchor" href="#randomised-cell-sampling-liquid-biopsy"></a>
</h2>
<p>ProCESS supports randomized cell sampling over the full tissue or a
rectangle thereof.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># collect up to 2500 tumour cells randomly selected over the whole tissue</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_2_3"</span>, num_of_cells <span class="op">=</span> <span class="fl">2500</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">search_sample</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="va">ncells</span><span class="op">)</span>, <span class="va">n_w</span>, <span class="va">n_h</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># collect up to 200 tumour cells randomly selected in the provided</span></span>
<span><span class="co"># bounding box</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_2_4"</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span>, <span class="fl">200</span><span class="op">)</span></span>
<span></span>
<span><span class="va">forest</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">get_samples_forest</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_forest.html">plot_forest</a></span><span class="op">(</span><span class="va">forest</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/annotate_forest.html">annotate_forest</a></span><span class="op">(</span><span class="va">forest</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="two-populations-with-epigenetic-state">Two populations with epigenetic state<a class="anchor" aria-label="anchor" href="#two-populations-with-epigenetic-state"></a>
</h2>
<p>We are now ready to simulate a model with epigenetic switches and
subclonal expansions.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set the seed of the random number generator</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SpatialSimulation.html">SpatialSimulation</a></span><span class="op">(</span><span class="st">"Two Populations"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="va">death_activation_level</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span></span>
<span><span class="co"># First mutant</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_mutant</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"A"</span>,</span>
<span>               epigenetic_rates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"+-"</span> <span class="op">=</span> <span class="fl">0.01</span>, <span class="st">"-+"</span> <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>               growth_rates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"+"</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="st">"-"</span> <span class="op">=</span> <span class="fl">0.08</span><span class="op">)</span>,</span>
<span>               death_rates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"+"</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="st">"-"</span> <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">place_cell</span><span class="op">(</span><span class="st">"A+"</span>, <span class="fl">500</span>, <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">run_up_to_size</span><span class="op">(</span><span class="st">"A+"</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [████████████████████████████████████████] 100% [00m:00s] Saving snapshot</span></span>
<span><span class="fu"><a href="../reference/plot_tissue.html">plot_tissue</a></span><span class="op">(</span><span class="va">sim</span>, num_of_bins <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-24-1.png" width="288"></p>
<p>We sample before introducing a new mutant.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bbox_width</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_1_1"</span>,</span>
<span>                 bottom_left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">480</span>, <span class="fl">480</span><span class="op">)</span>,</span>
<span>                 top_right <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">480</span> <span class="op">+</span> <span class="va">bbox_width</span>, <span class="fl">480</span> <span class="op">+</span> <span class="va">bbox_width</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_1_2"</span>,</span>
<span>                 bottom_left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>                 top_right <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span> <span class="op">+</span> <span class="va">bbox_width</span>, <span class="fl">500</span> <span class="op">+</span> <span class="va">bbox_width</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_tissue.html">plot_tissue</a></span><span class="op">(</span><span class="va">sim</span>, num_of_bins <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-25-1.png" width="288"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Let it grow a bit more</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">run_up_to_time</span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="fu">get_clock</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [████████████████████████████████████████] 100% [00m:00s] Saving snapshot</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_tissue.html">plot_tissue</a></span><span class="op">(</span><span class="va">sim</span>, num_of_bins <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-26-1.png" width="288"></p>
<p>Add a new submutant.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cell</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">choose_cell_in</span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_mutant</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"B"</span>,</span>
<span>               epigenetic_rates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"+-"</span> <span class="op">=</span> <span class="fl">0.05</span>, <span class="st">"-+"</span> <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>               growth_rates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"+"</span> <span class="op">=</span> <span class="fl">0.8</span>, <span class="st">"-"</span> <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>,</span>
<span>               death_rates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"+"</span> <span class="op">=</span> <span class="fl">0.05</span>, <span class="st">"-"</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">mutate_progeny</span><span class="op">(</span><span class="va">cell</span>, <span class="st">"B"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># let it grow more time units</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">run_up_to_size</span><span class="op">(</span><span class="st">"B+"</span>, <span class="fl">7000</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [█████████████████████████---------------] 61% [00m:00s] Cells: 55825 [████████████████████████████████████████] 100% [00m:00s] Saving snapshot</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_tissue.html">plot_tissue</a></span><span class="op">(</span><span class="va">sim</span>, num_of_bins <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-27-1.png" width="288"></p>
<p>Sample again and plot the tissue</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_w</span> <span class="op">&lt;-</span> <span class="va">n_h</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="va">ncells</span> <span class="op">&lt;-</span> <span class="fl">0.9</span> <span class="op">*</span> <span class="va">n_w</span> <span class="op">*</span> <span class="va">n_h</span></span>
<span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">search_sample</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="va">ncells</span><span class="op">)</span>, <span class="va">n_w</span>, <span class="va">n_h</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_2_1"</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">search_sample</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span> <span class="op">=</span> <span class="va">ncells</span><span class="op">)</span>, <span class="va">n_w</span>, <span class="va">n_h</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">sample_cells</span><span class="op">(</span><span class="st">"S_2_2"</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">lower_corner</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">upper_corner</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_tissue.html">plot_tissue</a></span><span class="op">(</span><span class="va">sim</span>, num_of_bins <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-28-1.png" width="288"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_muller.html">plot_muller</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-28-2.png" width="288"></p>
<p>Now we show the cell division tree, which starts being rather
complicated</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forest</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">get_samples_forest</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_forest.html">plot_forest</a></span><span class="op">(</span><span class="va">forest</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/annotate_forest.html">annotate_forest</a></span><span class="op">(</span><span class="va">forest</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-29-1.png" width="1632"></p>
<div class="section level3">
<h3 id="storing-samples-forests">Storing Samples Forests<a class="anchor" aria-label="anchor" href="#storing-samples-forests"></a>
</h3>
<p>A samples forest can be saved in a file by using the method
<code>SamplesForest$save()</code>.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check the file existence. It should not exists.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"samples_forest.sff"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span></span>
<span><span class="co"># save the samples forest in the file "samples_forest.sff"</span></span>
<span><span class="va">forest</span><span class="op">$</span><span class="fu">save</span><span class="op">(</span><span class="st">"samples_forest.sff"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check the file existence. It now exists.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"samples_forest.sff"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>The saved samples forest can successively be load by using the
function <code><a href="../reference/load_samples_forest.html">load_samples_forest()</a></code>.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the samples forest from "samples_forest.sff" and store it in `forest2`</span></span>
<span><span class="va">forest2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_samples_forest.html">load_samples_forest</a></span><span class="op">(</span><span class="st">"samples_forest.sff"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># let us now compare the samples forests stored in `forest` and `forest2`;</span></span>
<span><span class="co"># they should be the same.</span></span>
<span><span class="va">forest</span></span>
<span><span class="co">#&gt; SamplesForest</span></span>
<span><span class="co">#&gt;   # of trees: 1</span></span>
<span><span class="co">#&gt;   # of nodes: 5494</span></span>
<span><span class="co">#&gt;   # of leaves: 1390</span></span>
<span><span class="co">#&gt;   samples: {"S_1_1", "S_1_2", "S_2_1", "S_2_2"}</span></span>
<span><span class="va">forest2</span></span>
<span><span class="co">#&gt; SamplesForest</span></span>
<span><span class="co">#&gt;   # of trees: 1</span></span>
<span><span class="co">#&gt;   # of nodes: 5494</span></span>
<span><span class="co">#&gt;   # of leaves: 1390</span></span>
<span><span class="co">#&gt;   samples: {"S_1_1", "S_1_2", "S_2_1", "S_2_2"}</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alberto Casagrande, Giulio Caravagna.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
